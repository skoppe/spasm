<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
    <title>Spasm - Underrun example</title>
    <style>body{margin:0px;background:black;}#root{display:flex;justify-content:center;align-items:center;}div:last-child{color:#e90;}b{animation:r 1s infinite;}@keyframes r{50%{opacity:0;}}#c{height:100vh;image-rendering:optimizeSpeed;image-rendering:pixelated;cursor:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAHAQMAAAD+nMWQAAAABGdBTUEAALGPC/xhBQAAAAZQTFRFAAAA////pdmf3QAAAAF0Uk5TAEDm2GYAAAATSURBVAjXYxBgEGBgYDgGxEAWAAc4AQebSvKuAAAAAElFTkSuQmCC),auto;}code{font-weight:bold;color:#c80;position:absolute;top:4vw;left:2vw;font-size:1.6vw;overflow:hidden;white-space:nowrap;width:94%;text-shadow: 0 0 7px #f70;transition:opacity 1s;}.transparent code{opacity:0.0}.hide code{display:none;}</style></head>
    </head>
    <body>
        <div id="root"></div>
    <script type="text/javascript">!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){"use strict";function r(e,t,n){throw"ABORT: $what @ $file:$line"}n.r(t);const o=new TextDecoder("utf-8"),a=new TextEncoder,u=new WebAssembly.Memory({initial:256,maximum:256}),d={base:u,heap32:new Uint32Array(u.buffer),instance:null,decodeStr:(e,t)=>o.decode(new DataView(d.base.buffer,t,e)),encodeStrIn:(e,t)=>{const n=a.encode(t),r=d.instance.exports.allocString(n.length),o=new Uint8Array(d.base.buffer,r,n.length);return d.heap32[e/4]=n.length,d.heap32[e/4+1]=r,o.set(n),e},init:e=>{let t={env:Object.assign.apply(null,Object.keys(e).map(t=>e[t].jsExports))};WebAssembly.instantiateStreaming(fetch("underrun.wasm"),t).then(e=>{d.instance=e.instance,e.instance.exports._start()})}};d.jsExports={onOutOfMemoryError:()=>r(),_d_assert:(e,t)=>r(),doLog:e=>console.log(e),memory:d.base,__assert:function(){},_Unwind_Resume:function(){console.log(arguments)},_d_dynamic_cast:function(){console.log(arguments)}},t.default=d},function(e,t,n){"use strict";n.r(t);var r=n(0);const o={0:document};let a=0;const u=e=>null===e?0:void 0!==e.wasmId?e.asmDomPtr:(o[++a]=e,e.wasmId=a,a);let d=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","dfn","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","pre","progress","q","rb","rp","rt","rtc","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"];let i=["click","change","input","keydown","keyup","dblclick","blur","mousemove","mouseup","mousedown"],l=null;function c(e){const t=e.currentTarget.wasmId,n=e.currentTarget.wasmEvents[e.type],o=n.cbs;l=e,o.forEach(e=>r.default.instance.exports.domEvent(t,e.ctx,e.fun,n.eventType)),l=null}const s={nodes:o,addPtr:u,jsExports:{appendChild:function(e,t){o[e].appendChild(o[t])},insertBefore:function(e,t,n){o[e].insertBefore(o[t],o[n])},addCss:function(e,t){var n=document.createElement("style");n.type="text/css",n.innerHTML=r.default.decodeStr(e,t),document.getElementsByTagName("head")[0].appendChild(n)},addClass:function(e,t,n){o[e].classList.add(r.default.decodeStr(t,n))},removeClass:function(e,t,n){o[e].classList.remove(r.default.decodeStr(t,n))},changeClass:function(e,t,n,a){a?o[e].classList.add(r.default.decodeStr(t,n)):o[e].classList.remove(r.default.decodeStr(t,n))},unmount:function(e){var t=o[e];t.parentNode.removeChild(t)},removeChild:function(e){var t=o[e];t.parentNode.removeChild(t)},getRoot:function(){return u(document.querySelector("#root"))},createElement:function(e){return u(document.createElement(function(e){return d[e]}(e)))},focus:function(e){o[e].focus()},setSelectionRange:function(e,t,n){o[e].setSelectionRange(t,n)},innerText:function(e,t,n){o[e].innerText=r.default.decodeStr(t,n)},setAttribute:function(e,t,n,a,u){const d=r.default.decodeStr(t,n),i=r.default.decodeStr(a,u);o[e].setAttribute(d,i)},addEventListener:function(e,t,n,r,a){var u=i[t],d=o[e];if(void 0===d.wasmEvents)var l=d.wasmEvents={};else l=o[e].wasmEvents;l[u]&&l[u].cbs.length>0?l[u].cbs.push({ctx:n,fun:r}):(l[u]={cbs:[{ctx:n,fun:r}],eventType:a},d.addEventListener(u,c))},removeEventListener:function(e,t,n,r,a){var u=i[t];if(void 0!==o[e].wasmEvents){var d=o[e].wasmEvents;d[u]&&d[u].cbs.length>0&&(d[u].cbs=d[u].cbs.filter(e=>!(e.ctx==n&&e.fun==r)))}},getEventBool:function(e,t){return!!l[r.default.decodeStr(e,t)]},getEventInt:function(e,t){return 0+l[r.default.decodeStr(e,t)]},getEventString:function(e,t,n){return r.default.encodeStrIn(e,l[r.default.decodeStr(t,n)])},setPropertyBool:function(e,t,n,a){const u=o[e],d=r.default.decodeStr(t,n);u&&void 0!==u[d]&&(u[d]=a)},setPropertyInt:function(e,t,n,r){s.jsExports.setPropertyBool(e,t,n,r)},setProperty:function(e,t,n,a,u){const d=o[e],i=r.default.decodeStr(t,n);d&&void 0!==d[i]&&(d[i]=r.default.decodeStr(a,u))},getPropertyInt:function(e,t,n){const a=o[e],u=r.default.decodeStr(t,n);return!(!a||void 0===a[u])&&+a[u]},getPropertyBool:function(e,t,n){const a=o[e],u=r.default.decodeStr(t,n);return!(!a||void 0===a[u])&&!!a[u]},getProperty:function(e,t,n,a){const u=o[t],d=r.default.decodeStr(n,a);return u&&void 0!==u[d]?r.default.encodeStrIn(e,u[d]):r.default.encodeStrIn(e,"")}}};t.default=s},function(e,t,n){var r={};!function(e){e.keys().forEach(t=>r[t]=e(t).default)}(n(3)),r["./spasm.js"].init(r)},function(e,t,n){var r={"./audio.js":4,"./dom.js":1,"./game.js":5,"./spasm.js":0,"./webgl.js":6};function o(e){var t=a(e);return n(t)}function a(e){var t=r[e];if(!(t+1)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return t}o.keys=function(){return Object.keys(r)},o.resolve=a,e.exports=o,o.id=3},function(e,t,n){"use strict";n.r(t);n(1);var r=n(0);let o={top:0};function a(e){let t=o.top;return o[t]=e,o.top++,t}t.default={jsExports:{baseAudioContextDestination:function(e){var t=o[e].destination;return t.__handle||(t.__handle=a(t)),t.__handle},audioBufferSourceNodeLoopSet(e,t){o[e].loop=void 0},audioBufferSourceNodeConnect(e,t){o[e].connect(o[t])},audioBufferSourceNodeStart(e){o[e].start()},audioBufferSourceNodeBuffer(e,t){o[e].buffer=o[t]},windowNewAudioContext:function(){return a(new(window.webkitAudioContext||window.AudioContext))},baseAudioContextCreateBuffer:function(e,t,n,r){return a(o[e].createBuffer(t,n,r))},audioBufferGetChannelData:function(e,t){return a(o[e].getChannelData(t))},float32ArraySet:function(e,t,n){let a=new Float32Array(r.default.base.buffer,n,t);o[e].set(a)},baseAudioContextCreateBufferSource:function(e){return a(o[e].createBufferSource())},audioFree:function(e){delete o[e]}}}},function(e,t,n){"use strict";n.r(t);var r=n(1),o=n(0);t.default={jsExports:{atan2:(e,t)=>Math.atan2(e,t),cos:e=>Math.cos(e),sin:e=>Math.sin(e),sqrt:e=>Math.sqrt(e),random:()=>Math.random(),pow:(e,t)=>Math.pow(e,t),ldexpf:(e,t)=>Math.pow(e,t),setTimeout:(e,t,n)=>setTimeout(()=>{o.default.instance.exports.jsCallback0(e,t)},n),clearTimeout(e){clearTimeout(e)},load_image(e,t,n,a){let u=new Image;u.src="images/"+o.default.decodeStr(e,t)+".png",u.onload=function(){let e=r.default.addPtr(this);o.default.instance.exports.jsCallback(n,a,e)}},load_level(e,t,n,r,a){let u=new Image,d=new Uint8Array(o.default.base.buffer,n,4096);u.src="images/l"+e+".png",u.onload=function(){var e=document.createElement("canvas");e.width=e.height=64,(e=e.getContext("2d")).drawImage(this,0,0),e=e.getImageData(0,0,64,64).data;for(var t=0,u=0;t<64;t++)for(var i=0;i<64;i++,u++){var l=(e[4*u]>>4<<8)+(e[4*u+1]>>4<<4)+(e[4*u+2]>>4);d[u]=2184===l?2:15===l?4:3840===l?5:240===l?3:0!==l?1:0}o.default.instance.exports.jsCallback(r,a,n)}},scheduleFrame(e,t){requestAnimationFrame(()=>{let n=parseInt(performance.now(),10);o.default.instance.exports.jsCallback(e,t,n)})}}}},function(e,t,n){"use strict";n.r(t);var r=n(1),o=n(0);let a,u={},d={top:0};function i(e){let t=d.top;return d[t]=e,d.top++,t}t.default={jsExports:{getContext(e){let t=r.default.nodes[e];return u[e]=t.getContext("webgl")||t.getContext("experimental-webgl"),e},glSetContext(e){a=u[e]},glAttachShader(e,t){a.attachShader(d[e],d[t])},glBindBuffer(e,t){a.bindBuffer(e,d[t])},glBindTexture(e,t){a.bindTexture(e,d[t])},glBlendFunc(e,t){a.blendFunc(e,t)},glBufferData(e,t,n,r){let u=new Float32Array(o.default.base.buffer,n,t);a.bufferData(e,u,r)},glClear(e){a.clear(e)},glClearColor(e,t,n,r){a.clearColor(e,t,n,r)},glCompileShader(e){a.compileShader(d[e])},glCreateProgram:()=>i(a.createProgram()),glCreateShader:e=>i(a.createShader(e)),glDrawArrays(e,t,n){a.drawArrays(e,t,n)},glEnable(e){a.enable(e)},glEnableVertexAttribArray(e){a.enableVertexAttribArray(e)},glCreateBuffer:()=>i(a.createBuffer()),glCreateTexture:()=>i(a.createTexture()),glGetAttribLocation:(e,t,n)=>a.getAttribLocation(d[e],o.default.decodeStr(t,n)),glGetShaderInfoLog(e){},glGetUniformLocation:(e,t,n)=>i(a.getUniformLocation(d[e],o.default.decodeStr(t,n))),glLinkProgram(e){a.linkProgram(d[e])},glShaderSource(e,t,n){a.shaderSource(d[e],o.default.decodeStr(t,n))},glTexImage2D(e,t,n,o,u,d){a.texImage2D(e,t,n,o,u,r.default.nodes[d])},glTexParameteri(e,t,n){a.texParameteri(e,t,n)},glUniform1fv(e,t,n){let r=new Float32Array(o.default.base.buffer,n,t);a.uniform1fv(d[e],r)},glUniform3f(e,t,n,r){a.uniform3f(d[e],t,n,r)},glUseProgram(e){a.useProgram(d[e])},glVertexAttribPointer(e,t,n,r,o,u){a.vertexAttribPointer(e,t,n,r,o,u)},glViewport(e,t,n,r){a.viewport(e,t,n,r)}}}}]);</script></body>
</html>
